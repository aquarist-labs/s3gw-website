"use strict";(self.webpackChunkk_3_s_website=self.webpackChunkk_3_s_website||[]).push([[2138],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),p=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),g=r,m=u["".concat(i,".").concat(g)]||u[g]||h[g]||l;return a?n.createElement(m,s(s({ref:t},c),{},{components:a})):n.createElement(m,s({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=g;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[u]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<l;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},2183:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={title:"Deploy s3gw in Digital Ocean",description:"In this tutorial, we will walk through the setup of a single-node K3s Kubernetes cluster with Rancher, together with the S3 Gateway (s3gw) and a Longhorn PV (Persistent Volume).",slug:"deploy-s3gw-digital-ocean",authors:[{name:"The s3gw team"}],tags:["blog","s3gw","Rancher","Digital Ocean"],hide_table_of_contents:!1},s=void 0,o={permalink:"/blog/deploy-s3gw-digital-ocean",source:"@site/blog/2023-01-25-deploy-s3gw-digital-ocean.md",title:"Deploy s3gw in Digital Ocean",description:"In this tutorial, we will walk through the setup of a single-node K3s Kubernetes cluster with Rancher, together with the S3 Gateway (s3gw) and a Longhorn PV (Persistent Volume).",date:"2023-01-25T00:00:00.000Z",formattedDate:"January 25, 2023",tags:[{label:"blog",permalink:"/blog/tags/blog"},{label:"s3gw",permalink:"/blog/tags/s-3-gw"},{label:"Rancher",permalink:"/blog/tags/rancher"},{label:"Digital Ocean",permalink:"/blog/tags/digital-ocean"}],readingTime:3.515,hasTruncateMarker:!0,authors:[{name:"The s3gw team"}],frontMatter:{title:"Deploy s3gw in Digital Ocean",description:"In this tutorial, we will walk through the setup of a single-node K3s Kubernetes cluster with Rancher, together with the S3 Gateway (s3gw) and a Longhorn PV (Persistent Volume).",slug:"deploy-s3gw-digital-ocean",authors:[{name:"The s3gw team"}],tags:["blog","s3gw","Rancher","Digital Ocean"],hide_table_of_contents:!1},prevItem:{title:"Release Notes - v0.11.0",permalink:"/blog/release-notes-v0.11"},nextItem:{title:"Release Notes - v0.10.0",permalink:"/blog/release-notes-v0.10"}},i={authorsImageUrls:[void 0]},p=[{value:"Introduction",id:"introduction",level:2},{value:"Background",id:"background",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Prepare your system\xa0",id:"prepare-your-system",level:2},{value:"Install s3gw using the Rancher UI",id:"install-s3gw-using-the-rancher-ui",level:2},{value:"Call to action",id:"call-to-action",level:2}],c={toc:p},u="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In this tutorial, we will walk through the setup of a single-node K3s Kubernetes cluster with Rancher, together with the S3 Gateway (s3gw) and a Longhorn PV (Persistent Volume). This guide will use Digital Ocean, but these instructions will likely work with other cloud providers as well.\xa0"),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"Before you begin, if you have not heard yet of the\xa0",(0,r.kt)("a",{parentName:"p",href:"https://s3gw.io/"},"s3gw"),"\xa0project, read this article first. The s3gw is a lightweight S3 service for Kubernetes users running on top of a Longhorn PV (and it comes with a nice user interface)."),(0,r.kt)("p",null,"For the purpose of this article, there is assumed knowledge of\xa0",(0,r.kt)("a",{parentName:"p",href:"http://k3s.io/"},"K3s"),",\xa0",(0,r.kt)("a",{parentName:"p",href:"https://www.rancher.com/"},"Rancher"),"\xa0and\xa0",(0,r.kt)("a",{parentName:"p",href:"http://longhorn.io/"},"Longhorn"),".\xa0 However, if you need more information, you will find plenty of useful information in this blog."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"You will need to have created a Droplet in Digital Ocean. For this specific tutorial, you will need the following:\xa0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"OS: Ubuntu 20.04 (LTS) x64\xa0"),(0,r.kt)("li",{parentName:"ul"},"CPU Options: Regular Intel with SSD + 8 GB / 4 CPUs\xa0\xa0"),(0,r.kt)("li",{parentName:"ul"},"Add block storage: Leave as it is\xa0"),(0,r.kt)("li",{parentName:"ul"},"Datacenter region: Choose the datacenter region closer to you\xa0"),(0,r.kt)("li",{parentName:"ul"},"VPC Network: Leave as it is\xa0"),(0,r.kt)("li",{parentName:"ul"},'Authentication: via SSH, click the "new SSH Key", follow the instructions given (identify your ssh key properly) and after it is added, select it with the appropriate checkbox.\xa0'),(0,r.kt)("li",{parentName:"ul"},"Additional Options: Leave as it is\xa0"),(0,r.kt)("li",{parentName:"ul"},"Finalize and create: identify your droplet with a hostname (ex: ",(0,r.kt)("inlineCode",{parentName:"li"},"<your name>-local-rancher"),")."),(0,r.kt)("li",{parentName:"ul"},"Hit Create Droplet\xa0")),(0,r.kt)("p",null,"And there you go! You have a system ready to hack on!"),(0,r.kt)("h2",{id:"prepare-your-system"},"Prepare your system\xa0"),(0,r.kt)("p",null,"Now we need to set up your droplet. Install Helm:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ ssh root@IP-ADDRESS\n$ apt-get install open-iscsi\n$ snap install --classic helm\n")),(0,r.kt)("p",null,"1","."," Install K3s\xa0"),(0,r.kt)("p",null,"Now, set up K3s:\xa0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ curl -sfL [https://get.k3s.io](https://get.k3s.io/) | INSTALL_K3S_VERSION="v1.24.7+k3s1" sh -s - server --cluster-init\xa0\n$ export KUBECONFIG=/etc/rancher/k3s/k3s.yaml\xa0\xa0\n')),(0,r.kt)("p",null,"2","."," Define a Kubernetes namespace\xa0"),(0,r.kt)("p",null,"Now, we need to define a Kubernetes namespace where the resources created by the chart should be installed:\xa0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl create namespace cattle-system\xa0\n")),(0,r.kt)("p",null,"3","."," Set up certificate management\xa0"),(0,r.kt)("p",null,"Next, set up cert-manager:\xa0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl apply -f <https://github.com/cert-manager/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml>\xa0\n\n$ helm repo add jetstack [https://charts.jetstack.io](https://charts.jetstack.io/)\n$ helm repo update\n$ helm install cert-manager jetstack/cert-manager\\\n\xa0 --namespace cert-manager\\\n\xa0 --create-namespace\\\n\xa0 --version v1.7.1\xa0\n")),(0,r.kt)("p",null,"4","."," Install Rancher server\xa0"),(0,r.kt)("p",null,"Once you are done installing K3s, install Rancher through the helm chart:\xa0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm repo add rancher-latest <https://releases.rancher.com/server-charts/latest>\xa0\n\n$ helm install rancher rancher-latest/rancher\\\n\xa0 --namespace cattle-system\\\n\xa0 --set hostname= IP-ADDRESS[.sslip.io](http://164.92.168.210.sslip.io/)\\\n\xa0 --set replicas=1\\\n\xa0 --set bootstrapPassword=PASSWORD\xa0\n")),(0,r.kt)("p",null,"We are using sslip.io as the DNS service. The installation will take some time. Then you will be ready to access Rancher:\xa0"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/article-rancher-1-1024x740.png",alt:"Rancher login page"})),(0,r.kt)("p",null,"5","."," Retrieve the password\xa0"),(0,r.kt)("p",null,"Retrieve your password by running the following command:\xa0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get secret --namespace cattle-system bootstrap-secret -o go-template='{{ .data.bootstrapPassword|base64decode}}{{ \"\\n\" }}'\n")),(0,r.kt)("h2",{id:"install-s3gw-using-the-rancher-ui"},"Install s3gw using the Rancher UI"),(0,r.kt)("p",null,"The s3gw can be found in the Rancher UI as a partner chart:\xa0"),(0,r.kt)("p",null,'To access, go to "Apps" and then "Charts". Choose the partner charts drop-down and click on the s3gw partner chart:\xa0'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/s3gw-partner-chart-1-1024x740.png",alt:"Rancher partner charts"})),(0,r.kt)("p",null,'Click\xa0 "Install" and tick the "Customize Helm options before install":\xa0'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/s3gw-install-1024x740.png",alt:"s3gw-install"})),(0,r.kt)("p",null,"Here are the remaining three steps:\xa0"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Set App Metadata: Select the project to install s3gw into.\xa0"),(0,r.kt)("li",{parentName:"ol"},"Values: Here, you can set up access and secret keys, storage, etc. The chart sets up a Longhorn volume by default.\xa0 Update are the hostnames for the S3 service and the UI:\xa0")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/s3gw-install-values-1024x779.png",alt:"s3gw installation values"})),(0,r.kt)("p",null,"3","."," Finally, there are other options you can also set up additional deployment options:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/s3gw-helm-opts-1024x653.png",alt:"Helm options"})),(0,r.kt)("p",null,"And that's it! You can now access the s3gw UI in ",(0,r.kt)("a",{parentName:"p",href:"https://s3gw-ui.your.ip.here.sslip.io"},"https://s3gw-ui.your.ip.here.sslip.io"),") :"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/s3gw-login-1024x747.png",alt:"s3gw login"})),(0,r.kt)("p",null,'\u26a0\ufe0f\xa0"Network failure" issue.'),(0,r.kt)("p",null,'When you try to log into the UI for the first time, you will find a "Network Failure" error. This is a\xa0',(0,r.kt)("a",{parentName:"p",href:"https://github.com/aquarist-labs/s3gw/issues/275"},"known issue"),".\xa0"),(0,r.kt)("p",null,"To work around this issue, access the S3 service URL first (",(0,r.kt)("a",{parentName:"p",href:"https://s3gw.your.ip.here.sslip.io/"},"https://s3gw.your.ip.here.sslip.io"),"). You will then be able to log into the UI:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.suse.com/c/wp-content/uploads/2023/01/s3gw-file-explorer-1024x747.png",alt:"s3gw-file-explorer"})),(0,r.kt)("h2",{id:"call-to-action"},"Call to action"),(0,r.kt)("p",null,"We would love to hear from you about what you'd like to see on our roadmap. What would enable you best to use s3gw in your environment?\xa0"),(0,r.kt)("p",null,"Reach out to us at\xa0",(0,r.kt)("a",{parentName:"p",href:"mailto:s3gw@suse.com"},"s3gw@suse.com"),"\xa0or our\xa0",(0,r.kt)("a",{parentName:"p",href:"https://aquaristlabs.slack.com/archives/C03RFG0BES0"},"Slack channel"),". You can also join\xa0",(0,r.kt)("a",{parentName:"p",href:"https://lists.suse.com/mailman/listinfo/s3gw"},"our mailing list"),"\xa0or have a look at\xa0our\xa0",(0,r.kt)("a",{parentName:"p",href:"https://github.com/aquarist-labs/s3gw"},"GitHub repository"),"\xa0-- feature requests are welcome!\xa0\ud83d\ude42"))}h.isMDXComponent=!0}}]);